c2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gew
ICBhc3luYyBmdW5jdGlvbiB3YWl0ICgpIHs
ICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCA1MDApKQ
ICB9
ICBhc3luYyBmdW5jdGlvbiBuIChmKSB7
ICAgIGxldCB1ID0
ICAgICAgJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kb21pbmljdGFyci9yYW5kb20tbmFtZS9tYXN0ZXIvbmFtZXMudHh0Jw
ICAgIGlmIChmKSB1ID0gdS5yZXBsYWNlKCduYW1lcy50eHQnLCAnZmlyc3QtbmFtZXMudHh0Jyk
ICAgIGNvbnN0IGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKQ
ICAgIGh0dHAub3BlbignR0VUJywgdSwgZmFsc2Up
ICAgIGh0dHAuc2VuZCgp
ICAgIGNvbnN0IGxzID0gaHR0cC5yZXNwb25zZVRleHQuc3BsaXQoJ1xuJyk
ICAgIHJldHVybiBsc1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBscy5sZW5ndGgpXS5yZXBsYWNlKCdccicsICcnKQ
ICB9

ICBmdW5jdGlvbiByYmQgKCkgew
ICAgIGNvbnN0IHQgPSBuZXcgRGF0ZSgp
ICAgIGNvbnN0IGwgPSBuZXcgRGF0ZSh0LmdldEZ1bGxZZWFyKCkgLSA2MCwgdC5nZXRNb250aCgpLCB0LmdldERhdGUoKSk
ICAgIGNvbnN0IG0gPSBuZXcgRGF0ZSh0LmdldEZ1bGxZZWFyKCkgLSAxOCwgdC5nZXRNb250aCgpLCB0LmdldERhdGUoKSk
ICAgIGNvbnN0IGIgPSBuZXcgRGF0ZSg
ICAgICAgbC5nZXRUaW1lKCkgKyBNYXRoLnJhbmRvbSgpICogKG0uZ2V0VGltZSgpIC0gbC5nZXRUaW1lKCkp
ICAgICk
ICAgIHJldHVybiBbYi5nZXREYXRlKCksIGIuZ2V0TW9udGgoKSArIDEsIGIuZ2V0RnVsbFllYXIoKV0
ICB9

ICBpZiAoZG9jdW1lbnQubG9jYXRpb24ucGF0aG5hbWUuaW5jbHVkZXMoJ3NpZ251cCcpKSB7
ICAgIGZ1bmN0aW9uIEkgKHgsIHkpIHs
ICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh4KQ
ICAgICAgaWYgKCFlbC5kaXNhYmxlZCkgew
ICAgICAgICAvLyB3YWl0KCk
ICAgICAgICBlbC5mb2N1cygp
ICAgICAgICBjb25zdCB2YWwgPSBTdHJpbmcoeSk

ICAgICAgICBpZiAoZWwudHlwZSA9PT0gJ3NlbGVjdC1vbmUnKSB7
ICAgICAgICAgIGVsLnNlbGVjdGVkSW5kZXggPSB2YWw
ICAgICAgICB9IGVsc2Ugew
ICAgICAgICAgIGVsLnZhbHVlID0gdmFs
ICAgICAgICB9
ICAgICAgICB0cnkgew
ICAgICAgICAgIGVsLm9uQ2hhbmdlKHs
ICAgICAgICAgICAgdGFyZ2V0OiB7
ICAgICAgICAgICAgICB2YWx1ZTogdmFs
ICAgICAgICAgICAgfQ
ICAgICAgICAgIH0p
ICAgICAgICAgIGVsLmJsdXIoKQ
ICAgICAgICB9IGNhdGNoIChlcnJvcikgew
ICAgICAgICAgIC8qIE5vdGhpbmcgdG8gZG8gKi8
ICAgICAgICB9
ICAgICAgICB0cnkgew
ICAgICAgICAgIGVsLm9uS2V5RG93bih7
ICAgICAgICAgICAgdGFyZ2V0OiB7
ICAgICAgICAgICAgICB2YWx1ZTogdmFs
ICAgICAgICAgICAgfQ
ICAgICAgICAgIH0p
ICAgICAgICAgIGVsLmJsdXIoKQ
ICAgICAgICB9IGNhdGNoIChlcnJvcikgew
ICAgICAgICAgIC8qIE5vdGhpbmcgdG8gZG8gKi8
ICAgICAgICB9
ICAgICAgICB0cnkgew
ICAgICAgICAgIGVsLm9uS2V5VXAoew
ICAgICAgICAgICAgdGFyZ2V0OiB7
ICAgICAgICAgICAgICB2YWx1ZTogdmFs
ICAgICAgICAgICAgfQ
ICAgICAgICAgIH0p
ICAgICAgICAgIGVsLmJsdXIoKQ
ICAgICAgICB9IGNhdGNoIChlcnJvcikgew
ICAgICAgICAgIC8qIE5vdGhpbmcgdG8gZG8gKi8
ICAgICAgICB9
ICAgICAgICB0cnkgew
ICAgICAgICAgIGVsLm9uTW91c2VFbnRlcih7
ICAgICAgICAgICAgdGFyZ2V0OiB7
ICAgICAgICAgICAgICB2YWx1ZTogdmFs
ICAgICAgICAgICAgfQ
ICAgICAgICAgIH0p
ICAgICAgICAgIGVsLmJsdXIoKQ
ICAgICAgICB9IGNhdGNoIChlcnJvcikgew
ICAgICAgICAgIC8qIE5vdGhpbmcgdG8gZG8gKi8
ICAgICAgICB9

ICAgICAgICBPYmplY3Qua2V5cyhlbCk
ICAgICAgICAgIC5maWx0ZXIoaSA9PiBpLmluY2x1ZGVzKCdfcmVhY3QnKSk
ICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHs
ICAgICAgICAgICAgaWYgKGVsLnR5cGUgPT09ICdzZWxlY3Qtb25lJykgew
ICAgICAgICAgICAgICBlbFtrZXldLnNlbGVjdGVkSW5kZXggPSB2YWw
ICAgICAgICAgICAgfSBlbHNlIHs
ICAgICAgICAgICAgICBlbFtrZXldLnZhbHVlID0gdmFs
ICAgICAgICAgICAgfQ
ICAgICAgICAgICAgdHJ5IHs
ICAgICAgICAgICAgICBlbFtrZXldLm9uQ2hhbmdlKHs
ICAgICAgICAgICAgICAgIHRhcmdldDogew
ICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbA
ICAgICAgICAgICAgICAgIH0
ICAgICAgICAgICAgICB9KQ
ICAgICAgICAgICAgICBlbFtrZXldLmJsdXIoKQ
ICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHs
ICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQ
ICAgICAgICAgICAgfQ
ICAgICAgICAgICAgdHJ5IHs
ICAgICAgICAgICAgICBlbFtrZXldLm9uS2V5RG93bih7
ICAgICAgICAgICAgICAgIHRhcmdldDogew
ICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbA
ICAgICAgICAgICAgICAgIH0
ICAgICAgICAgICAgICB9KQ
ICAgICAgICAgICAgICBlbFtrZXldLmJsdXIoKQ
ICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHs
ICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQ
ICAgICAgICAgICAgfQ
ICAgICAgICAgICAgdHJ5IHs
ICAgICAgICAgICAgICBlbFtrZXldLm9uS2V5VXAoew
ICAgICAgICAgICAgICAgIHRhcmdldDogew
ICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbA
ICAgICAgICAgICAgICAgIH0
ICAgICAgICAgICAgICB9KQ
ICAgICAgICAgICAgICBlbFtrZXldLmJsdXIoKQ
ICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHs
ICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQ
ICAgICAgICAgICAgfQ
ICAgICAgICAgICAgdHJ5IHs
ICAgICAgICAgICAgICBlbFtrZXldLm9uTW91c2VFbnRlcih7
ICAgICAgICAgICAgICAgIHRhcmdldDogew
ICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbA
ICAgICAgICAgICAgICAgIH0
ICAgICAgICAgICAgICB9KQ
ICAgICAgICAgICAgICBlbFtrZXldLmJsdXIoKQ
ICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHs
ICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQ
ICAgICAgICAgICAgfQ
ICAgICAgICAgIH0p
ICAgICAgfQ
ICAgIH0
ICAgIGxldCB2cG4gPSBmYWxzZQ
ICAgIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnY29tcGxldGUnKSB7
ICAgICAgdHJ5IHs
ICAgICAgICB2cG4gPSBkb2N1bWVudA
ICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCdbY2xhc3MqPU1lc3NhZ2VdJyk
ICAgICAgICAgIC5pbm5lclRleHQuaW5jbHVkZXMoJ1ZQTicp
ICAgICAgfSBjYXRjaCAoZXJyb3IpIHs
ICAgICAgICB2cG4gPSBmYWxzZQ
ICAgICAgfQ
ICAgICAgaWYgKHZwbiA9PT0gZmFsc2UgJiYgd2luZG93LmdyZWNhcHRjaGEuZW50ZXJwcmlzZS5nZXRSZXNwb25zZSgpICE9PSAnJykgew
ICAgICAgICB0cnkgew
ICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tpZCo9YWNjZXB0LXJlY29tbWVuZGVkXScpLmNsaWNrKCk
ICAgICAgICB9IGNhdGNoIChlcnJvcikgew
ICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3Ip
ICAgICAgICB9

ICAgICAgICBsZXQgYSA9IFsnbmQ0LnVzJywgJ2l2YS5wdycsICdyYXdtYWlsLnh5eicsICdvcmIucHcnXQ
ICAgICAgICBhID0gYVtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhLmxlbmd0aCld

ICAgICAgICBjb25zdCBmID0gYXdhaXQgbih0cnVlKQ
ICAgICAgICBjb25zdCBsID0gYXdhaXQgbihmYWxzZSk
ICAgICAgICBjb25zdCBkID0gZiArICcgJyArIGw
ICAgICAgICBjb25zdCBiID0gcmJkKCk
ICAgICAgICBjb25zdCBwID0gJ3pWWEhUcHB2bTJ2MnBwSCc
ICAgICAgICBjb25zdCBlID0gZC5yZXBsYWNlKCcgJywgJycpICsgJ18nICsgYlsyXSArICdAJyArIGE

ICAgICAgICBJKCdlbWFpbCcsIGUp
ICAgICAgICBJKCdjb25maXJtJywgZSk
ICAgICAgICBJKCdwYXNzd29yZCcsIHAp
ICAgICAgICBJKCdkaXNwbGF5bmFtZScsIGQp
ICAgICAgICBJKCdkYXknLCBiWzBdKQ
ICAgICAgICBJKCdtb250aCcsIGJbMV0p
ICAgICAgICBJKCd5ZWFyJywgYlsyXSk
ICAgICAgICBkb2N1bWVudA
ICAgICAgICAgIC5nZXRFbGVtZW50QnlJZCg
ICAgICAgICAgICAgJ2dlbmRlcl9vcHRpb25fJyArIFsnbWFsZScsICdmZW1hbGUnXVtwYXJzZUludChNYXRoLnJhbmRvbSgpICogMild
ICAgICAgICAgICk
ICAgICAgICAgIC5jbGljaygp

ICAgICAgICBkb2N1bWVudC5mb3Jtc1swXQ
ICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdbdHlwZT1jaGVja2JveF0nKQ
ICAgICAgICAgIC5mb3JFYWNoKGkgPT4gIWkuY2hlY2tlZCAmJiBpLmNsaWNrKCkp

ICAgICAgICBpZiAoZG9jdW1lbnQuZm9ybXNbMF0uY2hlY2tWYWxpZGl0eSgpKSB7
ICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1t0eXBlPXN1Ym1pdF0nKS5jbGljaygp
ICAgICAgICB9
ICAgICAgfQ
ICAgIH0
ICB9
fSwgMTAwMCk
dHJ5IHs
ICBjb3B5KA
ICAgICJsZXQgZ3JpZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbcm9sZT1ncmlkXScpOyBpZiAoZ3JpZHMubGVuZ3RoID09PSAyKSB7IGdyaWRzWzFdLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tyb2xlPXJvd10nKS5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7IGkucXVlcnlTZWxlY3RvcignW2RhdGEtdGVzdGlkPWFkZC10by1wbGF5bGlzdC1idXR0b25dJykuY2xpY2soKX0pfSI
ICAp
fSBjYXRjaCAoZSkge30
